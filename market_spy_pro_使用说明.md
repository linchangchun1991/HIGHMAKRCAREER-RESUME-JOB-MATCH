# 海马职加·市场雷达专业版 使用说明

## 📋 项目简介

`market_spy_pro.py` 是一个自动化市场情报采集系统，专门为海马职加销售团队设计。系统通过自动化浏览器（DrissionPage）抓取抖音和小红书平台上的竞品动态、负面舆情和用户评论，并利用 AI（DeepSeek）生成销售话术和应对策略。

---

## 🎯 核心功能

### 1. **竞品动态监测**
- 自动搜索指定竞品关键词（DBC职梦、途鸽求职、Offer先生、职问、爱思益、留学生求职）
- 筛选最近3天内的内容
- 提取视频/笔记的标题、链接、发布时间

### 2. **负面舆情抓取**
- 自动识别包含负面关键词的内容（避雷、坑、退费、骗局、投诉等）
- 深入详情页提取高赞评论
- 为销售团队提供"弹药"

### 3. **AI 智能分析**
- 基于 DeepSeek API 生成销售话术
- 输出三个核心板块：
  - 🚨 **竞品暴雷区**：负面舆情 + 销售话术
  - 📉 **价格/活动监测**：竞品促销活动
  - 🗣️ **真实学员声音**：用户真实评论

---

## 📦 环境要求

### Python 版本
- Python 3.9+

### 依赖包
```bash
pip3 install DrissionPage>=4.0.0 openai>=1.0.0 pandas>=2.0.0
```

或使用 requirements 文件：
```bash
pip3 install -r requirements_market_spy.txt
```

### 浏览器要求
- Chrome/Chromium 浏览器（用于 DrissionPage 自动化）
- 需要手动登录抖音和小红书账号（首次运行）

---

## ⚙️ 配置说明

### 硬编码配置（在代码中修改）

```python
# DeepSeek API 配置
DEEPSEEK_API_KEY = "sk-0337e474504349d6bf2396aa8484dbfa"
DEEPSEEK_BASE_URL = "https://api.deepseek.com"

# 竞品关键词列表
COMPETITOR_KEYWORDS = ['DBC职梦', '途鸽求职', 'Offer先生', '职问', '爱思益', '留学生求职']

# 负面关键词（用于筛选高价值内容）
NEGATIVE_KEYWORDS = ['避雷', '坑', '退费', '骗局', '投诉', '差评', '垃圾', '不要', '千万别', '吵架']

# 时间范围（最近3天）
DAYS_BACK = 3
```

---

## 🚀 使用方法

### 1. 首次运行（需要手动登录）

```bash
python3 market_spy_pro.py
```

**流程说明**：
1. 脚本会自动打开 Chrome 浏览器
2. 打开抖音和小红书标签页
3. **暂停30秒**，等待你手动登录（扫码或输入账号密码）
4. 登录完成后，脚本自动继续采集

### 2. 跳过登录（已登录状态）

如果浏览器已经登录，可以使用 `--skip-login` 参数：

```bash
python3 market_spy_pro.py --skip-login
```

### 3. 测试模式（使用模拟数据）

```bash
python3 market_spy_pro.py --test
```

---

## 📊 输出文件

### 1. `raw_data.csv`
原始采集数据，包含以下字段：
- `platform`: 平台（douyin/xiaohongshu）
- `keyword`: 搜索关键词
- `title`: 标题
- `url`: 链接
- `date`: 发布时间
- `snippet`: 摘要
- `comments`: 评论（JSON格式）

### 2. `Market_Daily_Report_YYYY-MM-DD.md`
AI 生成的日报，包含：
- 🚨 竞品暴雷区（负面舆情 + 销售话术）
- 📉 价格/活动监测
- 🗣️ 真实学员声音（评论区精华）

### 3. `market_spy_pro.log`
运行日志文件，记录采集过程和错误信息

---

## 🔧 工作流程

```
1. 初始化浏览器和 AI 客户端
   ↓
2. 手动登录（首次运行）
   ↓
3. 抖音采集
   - 搜索每个竞品关键词
   - 点击"最新"排序
   - 提取前10条视频
   - 过滤最近3天内容
   - 进入详情页提取评论（如有）
   ↓
4. 小红书采集
   - 搜索每个竞品关键词
   - 点击"最新"排序
   - 提取前15条笔记
   - 过滤最近3天内容
   - 如果包含负面关键词，进入详情页提取评论
   ↓
5. 保存原始数据到 CSV
   ↓
6. AI 分析生成日报
   ↓
7. 保存 Markdown 报告
```

---

## ⚠️ 注意事项

### 1. **浏览器连接问题**
如果遇到 `BrowserConnectError`，请：
- 确保 Chrome 浏览器已安装
- 关闭所有 Chrome 窗口
- 重新运行脚本

### 2. **登录超时**
- 首次运行会暂停30秒等待登录
- 如果30秒不够，可以修改代码中的 `time.sleep(30)` 时间

### 3. **数据采集失败**
可能原因：
- 页面结构变化，需要更新选择器
- 网络问题导致页面加载慢
- 账号被限流

**解决方案**：
- 查看 `market_spy_pro.log` 日志文件
- 检查浏览器中页面是否正常加载
- 尝试手动访问对应页面

### 4. **AI 分析失败**
如果 DeepSeek API 调用失败：
- 检查 API Key 是否有效
- 检查网络连接
- 查看日志中的错误信息

---

## 🐛 常见问题

### Q1: 为什么采集到 0 条数据？
**A**: 可能原因：
1. 页面元素选择器需要更新（平台改版）
2. 搜索结果为空（最近3天确实没有相关内容）
3. 时间过滤太严格

**解决方法**：
- 查看日志文件，确认是否找到元素
- 手动访问对应平台，验证是否有搜索结果
- 调整 `DAYS_BACK` 参数，扩大时间范围

### Q2: 如何修改搜索关键词？
**A**: 在代码中修改 `COMPETITOR_KEYWORDS` 列表：
```python
COMPETITOR_KEYWORDS = ['你的关键词1', '你的关键词2']
```

### Q3: 如何修改负面关键词？
**A**: 在代码中修改 `NEGATIVE_KEYWORDS` 列表：
```python
NEGATIVE_KEYWORDS = ['避雷', '坑', '退费', ...]
```

### Q4: 如何修改时间范围？
**A**: 修改 `DAYS_BACK` 变量：
```python
DAYS_BACK = 7  # 改为7天
```

---

## 📝 代码结构

```
market_spy_pro.py
├── 配置部分
│   ├── DeepSeek API 配置
│   ├── 竞品关键词
│   ├── 负面关键词
│   └── 时间范围
├── MarketSpyPro 类
│   ├── __init__()          # 初始化浏览器和 AI
│   ├── is_recent()         # 时间过滤函数
│   ├── manual_login()      # 手动登录流程
│   ├── crawl_douyin()      # 抖音采集
│   ├── crawl_xhs()         # 小红书采集
│   ├── save_raw_data()     # 保存原始数据
│   ├── generate_report()   # AI 生成报告
│   └── run()               # 主流程
└── main()                  # 命令行入口
```

---

## 🔄 更新日志

### v1.0 (2025-12-13)
- ✅ 初始版本发布
- ✅ 支持抖音和小红书采集
- ✅ DeepSeek AI 分析
- ✅ 自动生成销售话术

---

## 📞 技术支持

如遇问题，请：
1. 查看 `market_spy_pro.log` 日志文件
2. 检查浏览器控制台错误
3. 确认 API Key 和网络连接

---

## 📄 许可证

内部使用，仅供海马职加销售团队使用。

---

**最后更新**: 2025-12-13
