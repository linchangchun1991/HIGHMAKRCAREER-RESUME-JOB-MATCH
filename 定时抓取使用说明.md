# AceOffer 招聘信息定时抓取使用说明

## 功能说明

定时抓取脚本会在**每天早上9点**和**晚上5点**自动运行，抓取当天更新的招聘信息，并更新到Excel文件中。

## 安装依赖

```bash
pip install playwright pandas openpyxl schedule
playwright install chromium
```

## 使用方法

### 方式1：直接运行定时脚本（推荐）

```bash
python aceoffer_recruit_scheduler.py
```

脚本会持续运行，在指定时间自动执行抓取任务。

### 方式2：后台运行（使用nohup）

```bash
nohup python aceoffer_recruit_scheduler.py > scheduler.log 2>&1 &
```

### 方式3：使用screen（推荐用于服务器）

```bash
screen -S aceoffer_scraper
python aceoffer_recruit_scheduler.py
# 按 Ctrl+A 然后按 D 退出screen（脚本继续运行）
# 重新连接：screen -r aceoffer_scraper
```

## 配置说明

### 定时时间

在 `aceoffer_recruit_scheduler.py` 中可以修改：

```python
MORNING_TIME = "09:00"  # 早上9点
EVENING_TIME = "17:00"  # 晚上5点
```

### Excel文件路径

在 `aceoffer_recruit_scraper.py` 中可以修改：

```python
EXCEL_FILE_PATH = "recruit_data.xlsx"  # 固定文件名，用于增量更新
```

### 日期过滤

定时任务会自动启用日期过滤，只抓取当天更新的岗位。如果需要手动运行并抓取所有岗位，可以：

```python
# 在 aceoffer_recruit_scraper.py 中设置
ONLY_TODAY_UPDATED = False  # 设置为 False 抓取所有岗位
```

## 工作流程

1. **定时触发**：每天9:00和17:00自动触发
2. **日期过滤**：只抓取"更新时间"为今天的岗位
3. **增量更新**：新数据追加到现有Excel文件
4. **自动去重**：基于"相关链接"自动去重，避免重复数据

## 输出文件

- **文件名**：`recruit_data.xlsx`（固定文件名）
- **位置**：脚本运行目录
- **格式**：包含所有字段的Excel表格

## 查看日志

如果使用nohup运行，可以查看日志：

```bash
tail -f scheduler.log
```

## 停止服务

如果在前台运行，按 `Ctrl+C` 停止。

如果在后台运行，使用：

```bash
ps aux | grep aceoffer_recruit_scheduler
kill <PID>
```

## 注意事项

1. **首次运行**：需要确保Chrome用户数据目录中没有锁文件
2. **登录状态**：确保已在Chrome中登录目标网站
3. **网络连接**：确保网络连接正常
4. **磁盘空间**：确保有足够的磁盘空间保存Excel文件

## 故障排查

### 问题1：Chrome用户数据目录被占用

```bash
pkill -9 -f "Chrome.*Chrome_Scraper"
rm -f "/Users/changchun/Library/Application Support/Google/Chrome_Scraper/SingletonLock"
```

### 问题2：脚本无法导入

确保 `aceoffer_recruit_scraper.py` 和 `aceoffer_recruit_scheduler.py` 在同一目录下。

### 问题3：定时任务不执行

检查系统时间是否正确，确保脚本持续运行。
