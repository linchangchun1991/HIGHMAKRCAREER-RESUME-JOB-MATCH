# 阿里云通义千问 API 集成总结

## ✅ 已完成的工作

### 1. 依赖安装
- ✅ `pdf-parse` - PDF 文件解析
- ✅ `mammoth` - Word 文件解析
- ✅ `openai` - OpenAI SDK（兼容模式调用阿里云 Qwen）
- ✅ `@types/pdf-parse` - TypeScript 类型定义

### 2. 环境变量配置
- ✅ 创建 `env.example` 示例文件
- ✅ 配置 `.gitignore` 忽略 `.env.local` 文件
- ✅ 支持 `ALIBABA_CLOUD_API_KEY` 配置
- ✅ 支持自定义 API 端点配置

### 3. 工具函数
- ✅ `lib/file-parser.ts` - 文件解析工具（PDF/Word）
- ✅ `lib/qwen-client.ts` - 阿里云 Qwen API 客户端封装

### 4. API 路由
- ✅ `/api/analyze-resume` - 简历解析 API
  - 接收文件上传
  - 提取文本内容
  - 调用 Qwen-Turbo 模型分析
  - 返回结构化数据
  
- ✅ `/api/match-jobs` - 岗位匹配 API
  - 接收简历分析结果和岗位列表
  - 调用 Qwen 模型进行智能匹配
  - 返回匹配度最高的3个岗位
  - 包含推荐理由和差距分析

### 5. 前端集成
- ✅ 更新教练端页面 (`/dashboard/coach`)
  - 集成真实的 API 调用
  - 添加加载状态显示
  - 更新数据结构以匹配 API 响应
  - 显示推荐理由和差距分析

## 📋 API 功能说明

### 简历解析流程

1. **文件上传** → 前端上传 PDF/Word 文件
2. **文本提取** → 使用 `pdf-parse` 或 `mammoth` 提取文本
3. **AI 分析** → 调用 Qwen-Turbo 模型提取关键信息
4. **结构化返回** → 返回 JSON 格式的简历数据

### 岗位匹配流程

1. **接收数据** → 接收简历分析结果和岗位列表
2. **AI 匹配** → 调用 Qwen 模型进行智能评分
3. **评分标准**：
   - 专业对口度（30分）
   - 技能重合度（40分）
   - 项目经验相关性（20分）
   - 求职意向匹配度（10分）
4. **返回结果** → 返回匹配度最高的3个岗位

## 🔧 配置步骤

1. **安装依赖**
   ```bash
   npm install
   ```

2. **配置环境变量**
   ```bash
   cp env.example .env.local
   # 编辑 .env.local，填入你的 API Key
   ```

3. **启动开发服务器**
   ```bash
   npm run dev
   ```

## 📝 AI 提示词

### 简历解析提示词
```
你是一个资深的职业规划专家。请分析这份简历，提取以下信息并以 JSON 格式返回：
{
  "name": "姓名",
  "education": "教育背景（包括学校、专业、学历）",
  "skills": {
    "hard": ["硬技能1", "硬技能2"],
    "soft": ["软技能1", "软技能2"]
  },
  "experience": ["项目经验摘要1", "项目经验摘要2"],
  "intention": "求职意向（岗位方向、行业偏好等）"
}
```

### 岗位匹配提示词
```
你是一个资深的职业匹配专家。请对比简历和岗位列表，为每个岗位进行严格评分（0-100分）。

评分标准：
1. 专业是否对口（30分）
2. 技能重合度（40分）
3. 项目经验相关性（20分）
4. 求职意向匹配度（10分）

返回匹配度最高的3个岗位，包含匹配分数、推荐理由和差距分析。
```

## 🛡️ 错误处理

- ✅ 文件格式验证
- ✅ 文件内容验证
- ✅ API 调用错误处理
- ✅ JSON 解析失败备用方案
- ✅ 前端错误提示（Toast）

## 📚 相关文档

- [API_SETUP.md](./API_SETUP.md) - 详细的 API 使用说明
- [README.md](./README.md) - 项目总体说明
- [QUICK_START.md](./QUICK_START.md) - 快速启动指南

## ⚠️ 注意事项

1. **API Key 安全**：确保 `.env.local` 文件不被提交到版本控制
2. **API 调用频率**：注意阿里云的 API 调用频率限制
3. **文件大小**：建议文件大小不超过 10MB
4. **错误处理**：前端已实现完善的错误处理和用户提示

## 🚀 下一步优化建议

1. 添加文件大小限制检查
2. 实现文件上传进度显示
3. 添加 API 调用缓存机制
4. 实现岗位库数据库存储
5. 添加匹配记录历史存储
6. 优化 AI 提示词以提高准确性
